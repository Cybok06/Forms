<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Login • Admin</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<link rel="icon" href="https://store-images.s-microsoft.com/image/apps.44537.13628881801009959.f429098c-f6ba-4196-a164-1109adc458e8.5f1e249b-7942-4e1d-aa67-487271e222e5" type="image/x-icon">

<style>
  :root{
    --ink:#0b1320; --muted:#6b7280; --ring:#e5e7eb; --soft:#f6f8fb;
    --brand:#0ea5e9; --brand-dark:#087ab0; --brand-ink:#082a3a; --ok:#16a34a;
  }
  html,body{height:100%;}
  body{
    font-family: system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:
      radial-gradient(1200px 600px at 70% -10%, rgba(14,165,233,.25), transparent 60%),
      radial-gradient(1000px 500px at -10% 110%, rgba(2,132,199,.2), transparent 60%),
      var(--soft);
    color:var(--ink);
  }
  .wave{
    position:absolute; inset:0 auto auto 0; width:100%; height:200px; pointer-events:none;
    background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 55%, #0369a1 100%);
    clip-path: path("M0,120 C200,180 400,40 700,120 C950,180 1150,60 1440,120 L1440,0 L0,0 Z");
    opacity:.85;
  }
  .login-wrap{ min-height:100%; display:grid; place-items:center; padding:48px 16px; }
  .cardx{
    width:100%; max-width:420px; border:1px solid rgba(8,42,58,.08); border-radius:18px;
    background:rgba(255,255,255,.85); backdrop-filter: blur(10px);
    box-shadow: 0 10px 30px rgba(2,132,199,.12); overflow:hidden;
  }
  .cardx .header{ padding:28px 28px 18px; border-bottom:1px solid var(--ring);
    background:linear-gradient(180deg, rgba(14,165,233,.10), rgba(14,165,233,0)); }
  .brand-badge{ display:flex; align-items:center; gap:12px; font-weight:800; color:var(--brand-ink); }
  .brand-icon{ width:42px; height:42px; border-radius:12px; display:grid; place-items:center;
    background: linear-gradient(135deg, #0ea5e9, #0369a1); color:white; font-size:22px; }
  .subtl{ color:var(--muted); }
  .body{ padding:24px 28px 10px; }

  .form-label{ font-weight:600; color:#0b2030; }
  .form-control{
    border-radius:12px; border:1px solid #dfe4ea; padding:.65rem .9rem;
    transition: border-color .15s, box-shadow .15s;
  }
  .form-control:focus{
    border-color:var(--brand); box-shadow:0 0 0 .2rem rgba(14,165,233,.15);
  }
  .filled-ok{
    border-color: var(--ok) !important;
    box-shadow: 0 0 0 1px color-mix(in srgb, var(--ok) 60%, transparent);
  }
  .input-group-text{ border-radius:12px 0 0 12px; background:#f1f5f9; border-color:#dfe4ea; }
  .toggle-pass{ border:1px solid #dfe4ea; border-left:0; background:#f8fafc; color:#0b2030;
    border-radius:0 12px 12px 0; }
  .toggle-pass:hover{ background:#eef2f7; }

  .btn-brand{
    background: linear-gradient(135deg, #0ea5e9, #0284c7); border:0; color:#fff; font-weight:700;
    padding:.85rem 1rem; border-radius:12px; box-shadow: 0 8px 20px rgba(14,165,233,.35);
  }
  .btn-brand:disabled{ opacity:.65; }
  .corner-ribbon{ position:absolute; top:10px; right:-40px; transform:rotate(35deg);
    background:linear-gradient(135deg, #22d3ee, #0ea5e9); color:white; font-size:.75rem; padding:6px 50px; }
  .alert{ border-radius:12px; border:0; box-shadow: 0 6px 18px rgba(220,38,38,.08); }
</style>
</head>
<body>
<div class="wave"></div>

<div class="login-wrap">
  <div class="cardx position-relative">
    <div class="corner-ribbon"><i class="bi bi-shield-lock"></i> Secure</div>

    <div class="header">
      <div class="brand-badge">
        <div class="brand-icon"><i class="bi bi-grid-1x2"></i></div>
        <div>
          <div class="h5 m-0">Form Admin</div>
          <div class="subtl">Enter 6-digit admin passcode</div>
        </div>
      </div>
    </div>

    <div class="body">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for cat, msg in messages %}
            <div class="alert alert-{{cat}} d-flex align-items-start gap-2 py-2 px-3 mb-3">
              <i class="bi bi-info-circle mt-1"></i>
              <div>{{ msg }}</div>
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <form id="loginForm" method="post" action="{{ url_for('login', next=request.args.get('next')) }}" novalidate>
        <!-- Passcode -->
        <div class="mb-3">
          <label class="form-label" for="passcode"><i class="bi bi-key me-1"></i> Passcode</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-shield-lock"></i></span>
            <input
              id="passcode"
              name="passcode"
              type="password"
              class="form-control"
              placeholder="••••••"
              inputmode="numeric"
              pattern="\\d{6}"
              maxlength="6"
              autocomplete="one-time-code"
              required
            >
            <button class="btn toggle-pass" type="button" id="togglePass" aria-label="Show passcode">
              <i class="bi bi-eye"></i>
            </button>
          </div>
          <div class="form-text">6 digits required.</div>
        </div>

        <div class="d-grid">
          <button id="submitBtn" class="btn btn-brand" type="submit" disabled>
            <span class="btn-text"><i class="bi bi-box-arrow-in-right me-2"></i> Sign In</span>
            <span class="btn-loading d-none">
              <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
              Verifying…
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  const passInput = document.getElementById('passcode');
  const toggleBtn = document.getElementById('togglePass');
  const form = document.getElementById('loginForm');
  const submitBtn = document.getElementById('submitBtn');

  // Show/Hide passcode
  toggleBtn?.addEventListener('click', () => {
    const isPwd = passInput.type === 'password';
    passInput.type = isPwd ? 'text' : 'password';
    toggleBtn.innerHTML = isPwd ? '<i class="bi bi-eye-slash"></i>' : '<i class="bi bi-eye"></i>';
    toggleBtn.setAttribute('aria-label', isPwd ? 'Hide passcode' : 'Show passcode');
  });

  // Keep digits only, mark green when valid, enable button on 6 digits
  function sanitizeAndMark() {
    const raw = passInput.value || '';
    const digitsOnly = raw.replace(/\D/g, '').slice(0, 6);
    if (digitsOnly !== passInput.value) passInput.value = digitsOnly;

    const ok = /^\d{6}$/.test(digitsOnly);
    passInput.classList.toggle('filled-ok', ok);
    submitBtn.disabled = !ok;
  }
  passInput.addEventListener('input', sanitizeAndMark);
  window.addEventListener('DOMContentLoaded', sanitizeAndMark);

  // Submit loading state
  form?.addEventListener('submit', (e) => {
    // enforce client validation
    if (!/^\d{6}$/.test(passInput.value)) {
      e.preventDefault();
      passInput.focus();
      return;
    }
    submitBtn.disabled = true;
    form.querySelector('.btn-text').classList.add('d-none');
    form.querySelector('.btn-loading').classList.remove('d-none');
  });
</script>
</body>
</html>
